# ü§ñ Hubsy Bot - AI-Powered Food Ordering Assistant

–†–æ–∑—É–º–Ω–∏–π Telegram-–±–æ—Ç –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —ó–∂—ñ –∑ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—î—é —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É (Gemini AI) —Ç–∞ Google Sheets.

## ‚ú® –§—É–Ω–∫—Ü—ñ—ó (Phase 2)

### üéØ –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
- **üìã –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –º–µ–Ω—é** –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º–∏ —Ç–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—î—é
- **üîç –†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫** - "—Ö–æ—á—É —â–æ—Å—å —Å–æ–ª–æ–¥–∫–µ" ‚Üí AI –∑–Ω–∞–π–¥–µ –¥–µ—Å–µ—Ä—Ç–∏
- **‚ú® AI-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó** –Ω–∞ –æ—Å–Ω–æ–≤—ñ —ñ—Å—Ç–æ—Ä—ñ—ó –∑–∞–º–æ–≤–ª–µ–Ω—å
- **üõí –ö–æ—à–∏–∫** –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º —Å—É–º–∏
- **üìú –Ü—Å—Ç–æ—Ä—ñ—è –∑–∞–º–æ–≤–ª–µ–Ω—å** - —à–≤–∏–¥–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- **üî• –ü–æ–ø—É–ª—è—Ä–Ω—ñ —Å—Ç—Ä–∞–≤–∏** - —Ç—Ä–µ–∫—ñ–Ω–≥ –Ω–∞–π—á–∞—Å—Ç—ñ—à–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å
- **üí¨ –ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è** - –±–æ—Ç –∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î —É–ø–æ–¥–æ–±–∞–Ω–Ω—è

### ü§ñ AI-Features:
1. **–†–æ–∑—É–º–Ω–∏–π –ø–æ—à—É–∫ —É –≤—ñ–ª—å–Ω—ñ–π —Ñ–æ—Ä–º—ñ**
   - "–•–æ—á—É –º'—è—Å–Ω–µ" ‚Üí –ø–æ–∫–∞–∑—É—î –±—É—Ä–≥–µ—Ä–∏/–ø—ñ—Ü—É –∑ –º'—è—Å–æ–º
   - "–©–æ—Å—å —à–≤–∏–¥–∫–µ" ‚Üí —Å—Ç—Ä–∞–≤–∏ –∑ –∫–æ—Ä–æ—Ç–∫–∏–º —á–∞—Å–æ–º –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è
   
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó**
   - –ê–Ω–∞–ª—ñ–∑—É—î —ñ—Å—Ç–æ—Ä—ñ—é –∑–∞–º–æ–≤–ª–µ–Ω—å
   - –ü—Ä–æ–ø–æ–Ω—É—î —Å—Ö–æ–∂—ñ —Å—Ç—Ä–∞–≤–∏
   
3. **–î—ñ–∞–ª–æ–≥ –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º**
   - –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –º–µ–Ω—é
   - –î–æ–ø–æ–º–∞–≥–∞—î –∑ –≤–∏–±–æ—Ä–æ–º

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
ferrik-bot/
‚îú‚îÄ‚îÄ main.py                 # Flask app + bot logic
‚îú‚îÄ‚îÄ config.py              # Configuration
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ telegram.py        # Telegram API wrapper
‚îÇ   ‚îú‚îÄ‚îÄ sheets.py          # Google Sheets integration
‚îÇ   ‚îî‚îÄ‚îÄ gemini.py          # AI (Gemini) integration
‚îú‚îÄ‚îÄ requirements.txt       # Dependencies
‚îú‚îÄ‚îÄ .gitignore            # Security
‚îî‚îÄ‚îÄ .env.example          # Environment template
```

## üìä Google Sheets Structure

### –ê—Ä–∫—É—à "–ú–µ–Ω—é":
| ID | –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –°—Ç—Ä–∞–≤–∏ | –û–ø–∏—Å | –¶—ñ–Ω–∞ | –†–µ—Å—Ç–æ—Ä–∞–Ω | –†–µ–π—Ç–∏–Ω–≥ | –ê–∫—Ç–∏–≤–Ω–∏–π |
|----|-----------|--------|------|------|----------|---------|----------|
| PZ001 | –ü—ñ—Ü–∞ | –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ | –°–∏—Ä, —Ç–æ–º–∞—Ç–∏ | 150 | –ß–µ–ª–µ–Ω—Ç–∞–Ω–æ | 4.5 | –¢–∞–∫ |

### –ê—Ä–∫—É—à "–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è":
| ID –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è | Telegram User ID | –ß–∞—Å | –¢–æ–≤–∞—Ä–∏ (JSON) | –°—É–º–∞ | –°—Ç–∞—Ç—É—Å |
|---------------|------------------|-----|---------------|------|--------|
| ORD-xxx | 123456 | 2025-01-01 | [...] | 300 | –ù–æ–≤–µ |

## üöÄ Deployment (Render)

### 1. Environment Variables:

```bash
# Telegram
BOT_TOKEN=your_bot_token
WEBHOOK_SECRET=your_secure_secret_32chars

# Google Sheets
GOOGLE_SHEET_ID=your_spreadsheet_id
GOOGLE_CREDENTIALS_JSON={"type":"service_account",...}

# AI
GEMINI_API_KEY=your_gemini_key
GEMINI_MODEL_NAME=gemini-2.0-flash-exp

# Optional
OPERATOR_CHAT_ID=your_telegram_id
DEBUG=False
PORT=10000
```

### 2. –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ WEBHOOK_SECRET:
```python
import secrets
print(secrets.token_urlsafe(32))
```

### 3. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å webhook:
```bash
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://your-app.onrender.com/webhook",
    "secret_token": "YOUR_WEBHOOK_SECRET"
  }'
```

## üîí –ë–µ–∑–ø–µ–∫–∞

- ‚úÖ –°–µ–∫—Ä–µ—Ç–∏ –ù–ï –≤ –∫–æ–¥—ñ (—Ç—ñ–ª—å–∫–∏ ENV)
- ‚úÖ Webhook authentication —á–µ—Ä–µ–∑ X-Telegram-Bot-Api-Secret-Token
- ‚úÖ HTML escaping –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ injection
- ‚úÖ Thread-safe –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –∫–æ—Ä–∑–∏–Ω–∞–º–∏
- ‚úÖ Rate limiting –≥–æ—Ç–æ–≤–∏–π

## üìà –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ç—Ä–µ–∫–∞—î:
- üìä –ü–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å —Å—Ç—Ä–∞–≤ (Counter)
- üìú –Ü—Å—Ç–æ—Ä—ñ—é –∑–∞–º–æ–≤–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- üéØ –£–ø–æ–¥–æ–±–∞–Ω–Ω—è (—è–∫—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –æ–±–∏—Ä–∞—é—Ç—å)

## üõ†Ô∏è Local Development

```bash
# 1. Clone
git clone https://github.com/ferrik/ferrik-bot.git
cd ferrik-bot

# 2. Install
pip install -r requirements.txt

# 3. Create .env
cp .env.example .env
# –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –∑–º—ñ–Ω–Ω—ñ

# 4. Run
python main.py
```

## üìù User Flow

```
/start
  ‚Üì
–ì–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
  ‚Üì
‚îú‚îÄ‚Üí üçΩÔ∏è –ú–µ–Ω—é ‚Üí –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó ‚Üí –ö–∞—Ä—É—Å–µ–ª—å —Å—Ç—Ä–∞–≤ ‚Üí –î–æ–¥–∞—Ç–∏
‚îú‚îÄ‚Üí üî• –ü–æ–ø—É–ª—è—Ä–Ω–µ ‚Üí –¢–æ–ø-3 —Å—Ç—Ä–∞–≤–∏
‚îú‚îÄ‚Üí üîç –ü–æ—à—É–∫ (AI) ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç–∏
‚îú‚îÄ‚Üí ‚ú® AI-–ü–æ—Ä–∞–¥–∞ ‚Üí –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
‚îú‚îÄ‚Üí üõí –ö–æ—à–∏–∫ ‚Üí –û—Ñ–æ—Ä–º–∏—Ç–∏ ‚Üí ‚úÖ –ì–æ—Ç–æ–≤–æ
‚îî‚îÄ‚Üí üìú –Ü—Å—Ç–æ—Ä—ñ—è ‚Üí –ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
```

## üé® UX Improvements (Phase 2)

1. **FSM (Finite State Machine)** - –∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
2. **–ö–∞—Ä—É—Å–µ–ª—å –∑ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—î—é** - ‚¨ÖÔ∏è 1/5 ‚û°Ô∏è
3. **–ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"** –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ
4. **–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è** - "–ü—Ä–∏–≤—ñ—Ç, –Ü–º'—è! –ë–∞—á—É —Ç–∏ –ª—é–±–∏—à –ü—ñ—Ü—É üòâ"
5. **–Ü—Å—Ç–æ—Ä—ñ—è** - —à–≤–∏–¥–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

## ü§ñ AI Integration

### Gemini API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è:

1. **–ü–æ—à—É–∫** - —Ä–æ–∑—É–º—ñ—î –∑–∞–ø–∏—Ç–∏ —É –≤—ñ–ª—å–Ω—ñ–π —Ñ–æ—Ä–º—ñ
2. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó** - –∞–Ω–∞–ª—ñ–∑ —ñ—Å—Ç–æ—Ä—ñ—ó + –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è
3. **–î—ñ–∞–ª–æ–≥** - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### –ü—Ä–æ–º–ø—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –¥–ª—è:
- –ö–æ—Ä–æ—Ç–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (2-3 —Ä–µ—á–µ–Ω–Ω—è)
- –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞
- –î—Ä—É–∂–Ω—ñ–π —Ç–æ–Ω
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ—Å—Ç—å

## üìä Performance

- **Menu cache**: 5 —Ö–≤–∏–ª–∏–Ω TTL
- **Thread-safe**: RLock –¥–ª—è –∫–æ—Ä–∑–∏–Ω/—Å—Ç–∞–Ω—ñ–≤
- **Retry logic**: 2 —Å–ø—Ä–æ–±–∏ –¥–ª—è AI requests
- **Logging**: Structured logging –∑ timestamp

## üîÆ Roadmap (Phase 3)

- [ ] üì∏ –§–æ—Ç–æ —Å—Ç—Ä–∞–≤ –∑ Google Sheets
- [ ] üí≥ –û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞ (LiqPay/Stripe)
- [ ] üìç –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –¥–æ—Å—Ç–∞–≤–∫–∏
- [ ] üë§ –ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- [ ] üéÅ –ü—Ä–æ–º–æ–∫–æ–¥–∏ —Ç–∞ –∑–Ω–∏–∂–∫–∏
- [ ] üìä Admin Dashboard (analytics)
- [ ] üåê Multi-restaurant support
- [ ] üì± Push-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞—Ç—É—Å

## üÜò Troubleshooting

### –ë–æ—Ç –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î:
```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ webhook
curl "https://api.telegram.org/bot<TOKEN>/getWebhookInfo"

# 2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ health
curl https://your-app.onrender.com/health

# 3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –Ω–∞ Render
# Dashboard ‚Üí Logs
```

### –ú–µ–Ω—é –ø–æ—Ä–æ–∂–Ω—î:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ GOOGLE_SHEET_ID
2. –î–æ–¥–∞–π—Ç–µ Service Account email –¥–æ —Ç–∞–±–ª–∏—Ü—ñ (Share ‚Üí Editor)
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∞—Ä–∫—É—à "–ú–µ–Ω—é" —ñ—Å–Ω—É—î
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–ª–æ–Ω–∫–∞ "–ê–∫—Ç–∏–≤–Ω–∏–π" = "–¢–∞–∫"

### AI –Ω–µ –ø—Ä–∞—Ü—é—î:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ GEMINI_API_KEY
2. –ó–º—ñ–Ω—ñ—Ç—å GEMINI_MODEL_NAME –Ω–∞ `gemini-2.0-flash-exp`
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–≤–æ—Ç–∏ –Ω–∞ https://aistudio.google.com

## üìû Support

- Issues: https://github.com/ferrik/ferrik-bot/issues
- Telegram: @ferrikfoot_bot

## üìÑ License

MIT License - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —è–∫ —Ö–æ—á–µ—Ç–µ!

---

**Made with üíô in Ukraine**