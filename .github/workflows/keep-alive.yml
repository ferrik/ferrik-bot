name: Keep FerrikBot Alive

on:
  schedule:
    # –ó–∞–ø—É—Å–∫ –∫–æ–∂–Ω—ñ 10 —Ö–≤–∏–ª–∏–Ω
    - cron: '*/10 * * * *'
  workflow_dispatch: # –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping keep-alive endpoint
      run: |
        echo "Pinging bot at $(date)"
        response=$(curl -s -w "HTTP_CODE:%{http_code}" https://ferrik-bot-zvev.onrender.com/keep-alive)
        echo "Response: $response"
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å –∫–æ–¥—É
        http_code=$(echo $response | grep -o "HTTP_CODE:[0-9]*" | cut -d: -f2)
        if [ "$http_code" = "200" ]; then
          echo "‚úÖ Keep-alive successful"
        else
          echo "‚ùå Keep-alive failed with code: $http_code"
          exit 1
        fi
        
    - name: Health check
      run: |
        echo "Health check at $(date)"
        response=$(curl -s -w "HTTP_CODE:%{http_code}" https://ferrik-bot-zvev.onrender.com/)
        echo "Health response: $response"
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å –∫–æ–¥—É (200 –∞–±–æ 404 - –æ–±–∏–¥–≤–∞ OK –¥–ª—è Flask)
        http_code=$(echo $response | grep -o "HTTP_CODE:[0-9]*" | cut -d: -f2)
        if [ "$http_code" = "200" ] || [ "$http_code" = "404" ]; then
          echo "‚úÖ Health check passed"
        else
          echo "‚ö†Ô∏è Health check returned: $http_code"
        fi
        
    - name: Test webhook endpoint
      run: |
        echo "Testing webhook endpoint"
        response=$(curl -s -w "HTTP_CODE:%{http_code}" -X POST https://ferrik-bot-zvev.onrender.com/webhook -H "Content-Type: application/json" -d '{"test": "ping"}')
        echo "Webhook response: $response"
        
    - name: Log completion
      run: |
        echo "üéØ Keep-alive cycle completed at $(date)"
        echo "Bot URL: https://ferrik-bot-zvev.onrender.com"